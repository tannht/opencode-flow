# ReasoningBank Integration Architecture

## System Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     claude-flow v2.7.0                           â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚  â”‚  CLI Layer     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚  Agent Executor â”‚                â”‚
â”‚  â”‚  (agent.js)    â”‚         â”‚  (TypeScript)   â”‚                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚         â”‚                            â”‚                          â”‚
â”‚         â”‚                            â–¼                          â”‚
â”‚         â”‚                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚         â”‚                   â”‚ Provider Managerâ”‚                â”‚
â”‚         â”‚                   â”‚  + RB Config    â”‚                â”‚
â”‚         â”‚                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚         â”‚                            â”‚                          â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚                                      â”‚                      â”‚  â”‚
â”‚                                      â–¼                      â–¼  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”˜
                                       â”‚                      â”‚
                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”
                   â”‚        agentic-flow@1.4.11                    â”‚
                   â”‚                                                â”‚
                   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
                   â”‚  â”‚     ReasoningBank Engine             â”‚    â”‚
                   â”‚  â”‚                                      â”‚    â”‚
                   â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚    â”‚
                   â”‚  â”‚  â”‚  1. RETRIEVE                â”‚    â”‚    â”‚
                   â”‚  â”‚  â”‚  â€¢ Top-k similarity search  â”‚    â”‚    â”‚
                   â”‚  â”‚  â”‚  â€¢ 4-factor scoring         â”‚    â”‚    â”‚
                   â”‚  â”‚  â”‚  â€¢ Domain filtering         â”‚    â”‚    â”‚
                   â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚    â”‚
                   â”‚  â”‚              â–¼                       â”‚    â”‚
                   â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚    â”‚
                   â”‚  â”‚  â”‚  2. JUDGE                   â”‚    â”‚    â”‚
                   â”‚  â”‚  â”‚  â€¢ LLM-based evaluation     â”‚    â”‚    â”‚
                   â”‚  â”‚  â”‚  â€¢ Heuristic fallback       â”‚    â”‚    â”‚
                   â”‚  â”‚  â”‚  â€¢ Confidence scoring       â”‚    â”‚    â”‚
                   â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚    â”‚
                   â”‚  â”‚              â–¼                       â”‚    â”‚
                   â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚    â”‚
                   â”‚  â”‚  â”‚  3. DISTILL                 â”‚    â”‚    â”‚
                   â”‚  â”‚  â”‚  â€¢ Extract patterns         â”‚    â”‚    â”‚
                   â”‚  â”‚  â”‚  â€¢ PII scrubbing            â”‚    â”‚    â”‚
                   â”‚  â”‚  â”‚  â€¢ Store with confidence    â”‚    â”‚    â”‚
                   â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚    â”‚
                   â”‚  â”‚              â–¼                       â”‚    â”‚
                   â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚    â”‚
                   â”‚  â”‚  â”‚  4. CONSOLIDATE (every 20)  â”‚    â”‚    â”‚
                   â”‚  â”‚  â”‚  â€¢ Deduplicate              â”‚    â”‚    â”‚
                   â”‚  â”‚  â”‚  â€¢ Detect contradictions    â”‚    â”‚    â”‚
                   â”‚  â”‚  â”‚  â€¢ Prune old memories       â”‚    â”‚    â”‚
                   â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚    â”‚
                   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
                   â”‚                    â”‚                          â”‚
                   â”‚                    â–¼                          â”‚
                   â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
                   â”‚         â”‚  SQLite Database    â”‚              â”‚
                   â”‚         â”‚  .swarm/memory.db   â”‚              â”‚
                   â”‚         â”‚                     â”‚              â”‚
                   â”‚         â”‚  â€¢ patterns         â”‚              â”‚
                   â”‚         â”‚  â€¢ embeddings       â”‚              â”‚
                   â”‚         â”‚  â€¢ trajectories     â”‚              â”‚
                   â”‚         â”‚  â€¢ metrics          â”‚              â”‚
                   â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Data Flow: Task Execution with Memory

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    User Executes Command                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  claude-flow agent run coder "Build REST API" --enable-memory   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  CLI Parser (agent.js)                                           â”‚
â”‚  â€¢ Parses flags: --enable-memory, --memory-domain, etc.          â”‚
â”‚  â€¢ Creates AgentExecutionOptions object                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  AgentExecutor.execute()                                         â”‚
â”‚                                                                  â”‚
â”‚  Step 1: Initialize Memory (if first time)                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  initializeMemory()                                     â”‚    â”‚
â”‚  â”‚  â€¢ Runs: agentic-flow reasoningbank init               â”‚    â”‚
â”‚  â”‚  â€¢ Creates .swarm/memory.db                             â”‚    â”‚
â”‚  â”‚  â€¢ Sets memoryEnabled = true                            â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                           â”‚                                      â”‚
â”‚                           â–¼                                      â”‚
â”‚  Step 2: Retrieve Memories (pre-task)                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  retrieveMemories(task, options)                        â”‚    â”‚
â”‚  â”‚  â€¢ Query: "Build REST API"                              â”‚    â”‚
â”‚  â”‚  â€¢ Top-k: 3 memories                                    â”‚    â”‚
â”‚  â”‚  â€¢ Domain filter: "api"                                 â”‚    â”‚
â”‚  â”‚  â€¢ Returns: [                                           â”‚    â”‚
â”‚  â”‚      {id: "m1", title: "API routing pattern"},         â”‚    â”‚
â”‚  â”‚      {id: "m2", title: "Auth middleware"},             â”‚    â”‚
â”‚  â”‚      {id: "m3", title: "Error handling"}               â”‚    â”‚
â”‚  â”‚    ]                                                    â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                           â”‚                                      â”‚
â”‚                           â–¼                                      â”‚
â”‚  Step 3: Inject Memories into Prompt                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  buildCommand(options, memories)                        â”‚    â”‚
â”‚  â”‚  â€¢ Original: "Build REST API"                           â”‚    â”‚
â”‚  â”‚  â€¢ Enhanced:                                            â”‚    â”‚
â”‚  â”‚    "Memory 1: API routing pattern                       â”‚    â”‚
â”‚  â”‚     Use express.Router() for modularity                 â”‚    â”‚
â”‚  â”‚                                                          â”‚    â”‚
â”‚  â”‚     Memory 2: Auth middleware                           â”‚    â”‚
â”‚  â”‚     Apply JWT verification before protected routes      â”‚    â”‚
â”‚  â”‚                                                          â”‚    â”‚
â”‚  â”‚     Memory 3: Error handling                            â”‚    â”‚
â”‚  â”‚     Use async/await with try-catch wrapper             â”‚    â”‚
â”‚  â”‚                                                          â”‚    â”‚
â”‚  â”‚     ---                                                  â”‚    â”‚
â”‚  â”‚     Task: Build REST API"                               â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                           â”‚                                      â”‚
â”‚                           â–¼                                      â”‚
â”‚  Step 4: Execute Agent                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  execAsync(command)                                     â”‚    â”‚
â”‚  â”‚  â€¢ Runs: npx agentic-flow --agent coder --task "..."   â”‚    â”‚
â”‚  â”‚  â€¢ Agent receives memories in context                   â”‚    â”‚
â”‚  â”‚  â€¢ Generates code using learned patterns                â”‚    â”‚
â”‚  â”‚  â€¢ Returns: { stdout, stderr }                          â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                           â”‚                                      â”‚
â”‚                           â–¼                                      â”‚
â”‚  Step 5: Learn from Execution (post-task)                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  learnFromExecution(taskId, result, memories)           â”‚    â”‚
â”‚  â”‚  â€¢ Verdict: "success" (task completed)                  â”‚    â”‚
â”‚  â”‚  â€¢ Confidence: 0.7                                      â”‚    â”‚
â”‚  â”‚  â€¢ Extracts: "REST API with Express boilerplate"       â”‚    â”‚
â”‚  â”‚  â€¢ Stores new memory with id: "m47"                     â”‚    â”‚
â”‚  â”‚  â€¢ Increments usage count for m1, m2, m3               â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                           â”‚                                      â”‚
â”‚                           â–¼                                      â”‚
â”‚  Step 6: Auto-Consolidation Check                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  taskCounter++ â†’ 20 tasks completed                     â”‚    â”‚
â”‚  â”‚  â€¢ Triggers consolidateMemories()                       â”‚    â”‚
â”‚  â”‚  â€¢ Deduplicates: 2 similar memories merged              â”‚    â”‚
â”‚  â”‚  â€¢ Prunes: 1 old unused memory removed                  â”‚    â”‚
â”‚  â”‚  â€¢ Duration: 8ms                                        â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                           â”‚                                      â”‚
â”‚                           â–¼                                      â”‚
â”‚  Step 7: Return Result                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  AgentExecutionResult {                                 â”‚    â”‚
â”‚  â”‚    success: true,                                       â”‚    â”‚
â”‚  â”‚    output: "REST API code...",                          â”‚    â”‚
â”‚  â”‚    duration: 2847ms,                                    â”‚    â”‚
â”‚  â”‚    memoryEnabled: true,                                 â”‚    â”‚
â”‚  â”‚    memoriesRetrieved: 3,                                â”‚    â”‚
â”‚  â”‚    memoriesUsed: ["m1", "m2", "m3"],                    â”‚    â”‚
â”‚  â”‚    memoryLearned: true,                                 â”‚    â”‚
â”‚  â”‚    newMemoryIds: ["m47"],                               â”‚    â”‚
â”‚  â”‚    memoryVerdict: "success",                            â”‚    â”‚
â”‚  â”‚    memoryConfidence: 0.7                                â”‚    â”‚
â”‚  â”‚  }                                                       â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  CLI Output                                                      â”‚
â”‚                                                                  â”‚
â”‚  ğŸ§  Retrieved 3 relevant memories                                â”‚
â”‚     Memory 1: API routing pattern (confidence: 0.85)             â”‚
â”‚     Memory 2: Auth middleware (confidence: 0.78)                 â”‚
â”‚     Memory 3: Error handling (confidence: 0.71)                  â”‚
â”‚                                                                  â”‚
â”‚  [Agent generates code output...]                                â”‚
â”‚                                                                  â”‚
â”‚  âœ… Task completed successfully                                  â”‚
â”‚  ğŸ“š Learned 1 new memory: REST API with Express boilerplate      â”‚
â”‚  âš¡ Execution time: 2.8s (46% faster than average)               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Memory Scoring Algorithm

```
For each candidate memory:

1. Embedding Similarity (Î± = 0.65)
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  similarity = cosine(query, memory)  â”‚
   â”‚             = dot(Q, M) / (||Q||Â·||M||) â”‚
   â”‚                                      â”‚
   â”‚  Example:                            â”‚
   â”‚  Query: "Build REST API"             â”‚
   â”‚  Memory: "API routing pattern"       â”‚
   â”‚  â†’ similarity = 0.87                 â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

2. Recency (Î² = 0.15)
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  recency = exp(-age_days / 30)       â”‚
   â”‚                                      â”‚
   â”‚  Example:                            â”‚
   â”‚  Memory created 10 days ago          â”‚
   â”‚  â†’ recency = exp(-10/30) = 0.72      â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

3. Reliability (Î³ = 0.20)
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  reliability = min(                  â”‚
   â”‚    confidence Ã— sqrt(usage / 10),    â”‚
   â”‚    1.0                               â”‚
   â”‚  )                                   â”‚
   â”‚                                      â”‚
   â”‚  Example:                            â”‚
   â”‚  confidence = 0.8, usage = 25        â”‚
   â”‚  â†’ reliability = min(                â”‚
   â”‚      0.8 Ã— sqrt(25/10), 1.0          â”‚
   â”‚    ) = min(0.8 Ã— 1.58, 1.0) = 1.0    â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

4. Diversity Penalty (Î´ = 0.10)
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  diversity = max_similarity_to_      â”‚
   â”‚              already_selected         â”‚
   â”‚                                      â”‚
   â”‚  Prevents redundant memories         â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

5. Final Score
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  score = Î±Â·similarity + Î²Â·recency +  â”‚
   â”‚          Î³Â·reliability - Î´Â·diversity â”‚
   â”‚                                      â”‚
   â”‚  Example:                            â”‚
   â”‚  = 0.65Ã—0.87 + 0.15Ã—0.72 +          â”‚
   â”‚    0.20Ã—1.0 - 0.10Ã—0.10             â”‚
   â”‚  = 0.566 + 0.108 + 0.20 - 0.01      â”‚
   â”‚  = 0.864                             â”‚
   â”‚                                      â”‚
   â”‚  âœ… High score â†’ Will be retrieved   â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

6. Sort and Select Top-k
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  memories.sort(by: score)            â”‚
   â”‚  return memories.slice(0, k)         â”‚
   â”‚                                      â”‚
   â”‚  Example (k=3):                      â”‚
   â”‚  [                                   â”‚
   â”‚    {score: 0.864, title: "m1"},     â”‚
   â”‚    {score: 0.791, title: "m2"},     â”‚
   â”‚    {score: 0.746, title: "m3"}      â”‚
   â”‚  ]                                   â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Configuration Layers

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Layer 1: Runtime Flags (Highest Priority)                    â”‚
â”‚  â€¢ --enable-memory                                             â”‚
â”‚  â€¢ --memory-k 5                                                â”‚
â”‚  â€¢ --memory-domain web                                         â”‚
â”‚  Overrides all other layers                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Layer 2: User Configuration (~/.claude/settings.json)        â”‚
â”‚  {                                                             â”‚
â”‚    "claude-flow": {                                            â”‚
â”‚      "execution": {                                            â”‚
â”‚        "reasoningbank": {                                      â”‚
â”‚          "enabled": true,                                      â”‚
â”‚          "retrievalK": 3,                                      â”‚
â”‚          "domains": ["web", "api"]                             â”‚
â”‚        }                                                       â”‚
â”‚      }                                                         â”‚
â”‚    }                                                           â”‚
â”‚  }                                                             â”‚
â”‚  Persists across sessions                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Layer 3: Default Configuration (provider-manager.ts)         â”‚
â”‚  getDefaultConfig() {                                          â”‚
â”‚    reasoningbank: {                                            â”‚
â”‚      enabled: false,                                           â”‚
â”‚      database: '.swarm/memory.db',                             â”‚
â”‚      retrievalK: 3,                                            â”‚
â”‚      autoConsolidate: true,                                    â”‚
â”‚      consolidateEvery: 20,                                     â”‚
â”‚      minConfidence: 0.5                                        â”‚
â”‚    }                                                           â”‚
â”‚  }                                                             â”‚
â”‚  Fallback when no configuration exists                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Resolution Order:
1. Check runtime flags
2. If not set, check user config
3. If not set, use defaults

Example:
  $ claude-flow agent run coder "task" --memory-k 5

  Resolved config:
  {
    enabled: true,        // from --enable-memory (implicit)
    retrievalK: 5,        // from --memory-k flag
    database: '.swarm/memory.db',  // from user config
    autoConsolidate: true  // from defaults
  }
```

## File Structure After Integration

```
claude-flow/
â”œâ”€â”€ package.json                       # agentic-flow@1.4.11
â”‚
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ execution/
â”‚   â”‚   â”œâ”€â”€ agent-executor.ts          # âœ… Extended with RB methods
â”‚   â”‚   â””â”€â”€ provider-manager.ts        # âœ… Added RB config
â”‚   â”‚
â”‚   â”œâ”€â”€ cli/
â”‚   â”‚   â””â”€â”€ simple-commands/
â”‚   â”‚       â””â”€â”€ agent.js               # âœ… Added --enable-memory flags
â”‚   â”‚                                  # âœ… Added memory subcommands
â”‚   â”‚
â”‚   â””â”€â”€ types/
â”‚       â””â”€â”€ reasoningbank.ts           # ğŸ†• TypeScript interfaces
â”‚
â”œâ”€â”€ tests/
â”‚   â”œâ”€â”€ unit/
â”‚   â”‚   â”œâ”€â”€ agent-executor.test.ts     # ğŸ†• RB unit tests
â”‚   â”‚   â””â”€â”€ provider-manager.test.ts   # ğŸ†• Config tests
â”‚   â”‚
â”‚   â””â”€â”€ integration/
â”‚       â””â”€â”€ reasoningbank.test.ts      # ğŸ†• E2E tests
â”‚
â”œâ”€â”€ docs/
â”‚   â”œâ”€â”€ REASONINGBANK_INTEGRATION_PLAN.md    # ğŸ†• This doc
â”‚   â”œâ”€â”€ REASONINGBANK_ARCHITECTURE.md        # ğŸ†• Architecture
â”‚   â”œâ”€â”€ REASONINGBANK_GUIDE.md               # ğŸ†• User guide
â”‚   â””â”€â”€ examples/
â”‚       â””â”€â”€ reasoningbank/
â”‚           â”œâ”€â”€ basic-usage.md               # ğŸ†• Examples
â”‚           â”œâ”€â”€ domain-filtering.md          # ğŸ†• Examples
â”‚           â””â”€â”€ team-sharing.md              # ğŸ†• Examples
â”‚
â””â”€â”€ .swarm/                            # Created at runtime
    â””â”€â”€ memory.db                      # SQLite database
```

## Performance Characteristics

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Operation Performance (ms)                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                               â”‚
â”‚  Database Connection       â–ˆâ–ˆ 1ms                             â”‚
â”‚  Memory Retrieval (k=3)    â–ˆâ–ˆâ–ˆâ–ˆ 3ms                           â”‚
â”‚  Memory Insertion          â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 1-2ms                       â”‚
â”‚  Batch Insert (100)        â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 112ms         â”‚
â”‚  Consolidation            â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 5-10ms                       â”‚
â”‚  Embedding (Claude API)    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 500ms      â”‚
â”‚  Judgment (Claude API)     â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 800ms     â”‚
â”‚                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Without API Keys (Heuristic Mode):
  â€¢ Retrieval: 1-3ms (local only)
  â€¢ Judgment: <1ms (rule-based)
  â€¢ Total overhead: <5ms per task

With API Keys (LLM Mode):
  â€¢ Retrieval: 1-3ms (local)
  â€¢ Judgment: 800ms (API call)
  â€¢ Total overhead: ~1s per task
  â€¢ Accuracy: 95% vs 70% heuristic

Memory Growth:
  â€¢ 1,000 memories: 1MB storage, 3ms retrieval
  â€¢ 10,000 memories: 10MB storage, 8ms retrieval
  â€¢ 100,000 memories: 100MB storage, 25ms retrieval
```

## Error Handling Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Graceful Degradation Strategy                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Error: Memory database not found
  â†“
Auto-initialize database
  â†“
If init fails â†’ Disable memory, continue without learning
  âœ… Task still executes

Error: Memory retrieval fails
  â†“
Log warning
  â†“
Continue with empty memory array
  âœ… Task executes without context

Error: Learning fails
  â†“
Log warning
  â†“
Skip memory creation
  âœ… Task result returned

Error: Consolidation fails
  â†“
Log warning
  â†“
Retry on next threshold
  âœ… System continues working

Error: API key missing (LLM mode)
  â†“
Fallback to heuristic judgment
  â†“
Accuracy: 70% vs 95%
  âœ… Learning still works

Error: Database corruption
  â†“
Backup and recreate
  â†“
Import from backup if available
  âœ… System recovers
```

---

**Next Steps:**
1. Review architecture with team
2. Approve integration plan
3. Begin Phase 1: Dependency update
4. Implement Phase 2: Interface extensions
5. Test and iterate

**Questions?**
- GitHub: https://github.com/ruvnet/claude-code-flow/issues
- Discord: https://discord.gg/claude-flow
