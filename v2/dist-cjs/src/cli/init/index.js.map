{"version":3,"sources":["../../../../src/cli/init/index.ts"],"sourcesContent":["// init/index.ts - Main init command orchestrator\nimport { printSuccess, printError } from '../utils.js';\nimport { createDirectoryStructure } from './directory-structure.js';\nimport { createSwarmCommands } from './swarm-commands.js';\nimport { createSparcEnvironment } from './sparc-environment.js';\nimport { createClaudeConfig } from './claude-config.js';\nimport { createBatchToolsGuide } from './batch-tools.js';\nimport { errorRecovery } from '../../utils/error-recovery.js';\n\nexport interface InitOptions {\n  sparc?: boolean;\n  force?: boolean;\n}\n\nexport async function initCommand(options: InitOptions = {}) {\n  // Wrap entire initialization in retry logic with automatic recovery\n  return errorRecovery.retryWithRecovery(\n    async () => {\n      try {\n        const fs = await import('fs/promises');\n        const path = await import('path');\n\n        printSuccess('Initializing Claude-Flow project...');\n\n        // Check WSL environment and apply fixes proactively\n        if (errorRecovery.isWSL()) {\n          console.log('ðŸ” WSL environment detected');\n          const wslCheck = await errorRecovery.recoverWSLErrors();\n          if (wslCheck.recovered) {\n            console.log('âœ… WSL environment optimized\\n');\n          }\n        }\n\n        // Phase 1: Create directory structure\n        console.log('\\nðŸ“ Phase 1: Creating directory structure...');\n        await createDirectoryStructure();\n\n        // Phase 2: Create base configuration\n        console.log('\\nâš™ï¸  Phase 2: Creating configuration...');\n        await createClaudeConfig(options);\n\n        // Phase 3: Create swarm commands and documentation\n        console.log('\\nðŸ¤– Phase 3: Creating swarm commands...');\n        await createSwarmCommands();\n\n        // Phase 4: Create batch tools guides\n        console.log('\\nðŸ”§ Phase 4: Creating batch tools guides...');\n        await createBatchToolsGuide();\n\n        // Phase 5: SPARC environment (if requested)\n        if (options.sparc) {\n          console.log('\\nðŸš€ Phase 5: Creating SPARC environment...');\n          await createSparcEnvironment();\n        }\n\n        // Success summary\n        console.log('\\nðŸŽ‰ Project initialized successfully!');\n        console.log('   ðŸ“ Created .claude/ directory structure');\n        console.log('   ðŸ“‹ Created comprehensive swarm command documentation');\n        console.log('   ðŸ”§ Created batch tools coordination guides');\n        console.log('   ðŸ“– Created detailed usage examples with orchestration');\n\n        console.log('\\n   Next steps:');\n        console.log('   1. Run \"claude-flow swarm --help\" to see swarm options');\n        console.log('   2. Check .claude/commands/swarm/ for detailed documentation');\n        console.log('   3. Review batch tools guide for orchestration patterns');\n        console.log('   4. Run \"claude-flow help\" for all available commands');\n\n        if (options.sparc) {\n          console.log('   5. Run \"claude-flow sparc modes\" to see available SPARC modes');\n          console.log('   6. Use TodoWrite/TodoRead for task coordination');\n          console.log('   7. Use Task tool for parallel agent execution');\n        }\n      } catch (error) {\n        // Attempt automatic error recovery\n        const recovery = await errorRecovery.recoverInitErrors(error);\n\n        if (recovery.recovered) {\n          console.log('âœ… Recovered from error, retrying initialization...\\n');\n          throw error; // Trigger retry\n        } else {\n          printError(\n            `Failed to initialize project: ${error instanceof Error ? error.message : String(error)}`,\n          );\n          throw error;\n        }\n      }\n    },\n    {\n      maxRetries: options.force ? 5 : 3,\n      delay: 1000,\n      onRetry: (attempt, error) => {\n        console.log(`\\nðŸ”„ Retry attempt ${attempt} after error recovery...`);\n      }\n    }\n  );\n}\n"],"names":["printSuccess","printError","createDirectoryStructure","createSwarmCommands","createSparcEnvironment","createClaudeConfig","createBatchToolsGuide","errorRecovery","initCommand","options","retryWithRecovery","fs","path","isWSL","console","log","wslCheck","recoverWSLErrors","recovered","sparc","error","recovery","recoverInitErrors","Error","message","String","maxRetries","force","delay","onRetry","attempt"],"mappings":"AACA,SAASA,YAAY,EAAEC,UAAU,QAAQ,cAAc;AACvD,SAASC,wBAAwB,QAAQ,2BAA2B;AACpE,SAASC,mBAAmB,QAAQ,sBAAsB;AAC1D,SAASC,sBAAsB,QAAQ,yBAAyB;AAChE,SAASC,kBAAkB,QAAQ,qBAAqB;AACxD,SAASC,qBAAqB,QAAQ,mBAAmB;AACzD,SAASC,aAAa,QAAQ,gCAAgC;AAO9D,OAAO,eAAeC,YAAYC,UAAuB,CAAC,CAAC;IAEzD,OAAOF,cAAcG,iBAAiB,CACpC;QACE,IAAI;YACF,MAAMC,KAAK,MAAM,MAAM,CAAC;YACxB,MAAMC,OAAO,MAAM,MAAM,CAAC;YAE1BZ,aAAa;YAGb,IAAIO,cAAcM,KAAK,IAAI;gBACzBC,QAAQC,GAAG,CAAC;gBACZ,MAAMC,WAAW,MAAMT,cAAcU,gBAAgB;gBACrD,IAAID,SAASE,SAAS,EAAE;oBACtBJ,QAAQC,GAAG,CAAC;gBACd;YACF;YAGAD,QAAQC,GAAG,CAAC;YACZ,MAAMb;YAGNY,QAAQC,GAAG,CAAC;YACZ,MAAMV,mBAAmBI;YAGzBK,QAAQC,GAAG,CAAC;YACZ,MAAMZ;YAGNW,QAAQC,GAAG,CAAC;YACZ,MAAMT;YAGN,IAAIG,QAAQU,KAAK,EAAE;gBACjBL,QAAQC,GAAG,CAAC;gBACZ,MAAMX;YACR;YAGAU,QAAQC,GAAG,CAAC;YACZD,QAAQC,GAAG,CAAC;YACZD,QAAQC,GAAG,CAAC;YACZD,QAAQC,GAAG,CAAC;YACZD,QAAQC,GAAG,CAAC;YAEZD,QAAQC,GAAG,CAAC;YACZD,QAAQC,GAAG,CAAC;YACZD,QAAQC,GAAG,CAAC;YACZD,QAAQC,GAAG,CAAC;YACZD,QAAQC,GAAG,CAAC;YAEZ,IAAIN,QAAQU,KAAK,EAAE;gBACjBL,QAAQC,GAAG,CAAC;gBACZD,QAAQC,GAAG,CAAC;gBACZD,QAAQC,GAAG,CAAC;YACd;QACF,EAAE,OAAOK,OAAO;YAEd,MAAMC,WAAW,MAAMd,cAAce,iBAAiB,CAACF;YAEvD,IAAIC,SAASH,SAAS,EAAE;gBACtBJ,QAAQC,GAAG,CAAC;gBACZ,MAAMK;YACR,OAAO;gBACLnB,WACE,CAAC,8BAA8B,EAAEmB,iBAAiBG,QAAQH,MAAMI,OAAO,GAAGC,OAAOL,QAAQ;gBAE3F,MAAMA;YACR;QACF;IACF,GACA;QACEM,YAAYjB,QAAQkB,KAAK,GAAG,IAAI;QAChCC,OAAO;QACPC,SAAS,CAACC,SAASV;YACjBN,QAAQC,GAAG,CAAC,CAAC,mBAAmB,EAAEe,QAAQ,wBAAwB,CAAC;QACrE;IACF;AAEJ"}